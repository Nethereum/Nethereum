@using MudBlazor
@using Nethereum.Wallet.UI.Components.WalletOverview
@using Nethereum.Wallet.UI.Components.Core.Localization
@inject IComponentLocalizer<WalletOverviewViewModel> Localizer

<MudStack Spacing="2" AlignItems="AlignItems.Center">

    @if (IsLoading)
    {
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
            <MudProgressCircular Size="Size.Small" Indeterminate="true" />
            <MudText Typo="Typo.caption" Color="Color.Secondary">
                @Localizer.GetString(WalletOverviewLocalizer.Keys.VerifiedBalanceLoading)
            </MudText>
        </MudStack>
    }
    else if (HasError && IsRpcLimitation)
    {
        <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.Info"
                     Color="Color.Warning" Size="Size.Small" />
            <MudText Typo="Typo.body2" Color="Color.Secondary">
                @Localizer.GetString(WalletOverviewLocalizer.Keys.VerifiedBalance)
            </MudText>
        </MudStack>
        <MudAlert Severity="Severity.Info" Dense="true" Variant="Variant.Text" Class="mt-1">
            @Localizer.GetString(WalletOverviewLocalizer.Keys.RpcLimitationMessage)
        </MudAlert>
    }
    else if (HasError && !HasFinalizedBalance && !HasOptimisticBalance)
    {
        <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.VerifiedUser"
                     Color="Color.Error" Size="Size.Small" />
            <MudText Typo="Typo.body2" Color="Color.Secondary">
                @Localizer.GetString(WalletOverviewLocalizer.Keys.VerifiedBalance)
            </MudText>
        </MudStack>
        <MudAlert Severity="Severity.Error" Dense="true" Variant="Variant.Text" Class="mt-1" Style="word-break: break-word; white-space: normal;">
            @ErrorMessage
        </MudAlert>
    }
    else
    {
        <MudStack Row="true" Spacing="1" AlignItems="AlignItems.Center">
            <MudIcon Icon="@Icons.Material.Filled.VerifiedUser"
                     Color="Color.Success" Size="Size.Small" />
            <MudText Typo="Typo.body2" Color="Color.Secondary">
                @Localizer.GetString(WalletOverviewLocalizer.Keys.VerifiedBalances)
            </MudText>
        </MudStack>

        <MudSimpleTable Dense="true" Hover="true" Class="mt-2" Style="width: 100%;">
            <tbody>
                <!-- Finalized Row -->
                <tr>
                    <td style="width: 40%;">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Lock" Size="Size.Small" Color="Color.Success" />
                            <MudText Typo="Typo.caption" Style="font-weight: 600;">
                                @Localizer.GetString(WalletOverviewLocalizer.Keys.FinalizedBalance)
                            </MudText>
                            <MudTooltip Text="@Localizer.GetString(WalletOverviewLocalizer.Keys.FinalizedBalanceTooltip)">
                                <MudIcon Icon="@Icons.Material.Filled.Info" Size="Size.Small" Color="Color.Default" Style="font-size: 14px;" />
                            </MudTooltip>
                        </MudStack>
                    </td>
                    <td style="text-align: right;">
                        @if (HasFinalizedBalance)
                        {
                            <MudText Typo="Typo.body2" Style="font-weight: 600;">
                                @FormattedFinalizedBalance @CurrencySymbol
                            </MudText>
                            <MudText Typo="Typo.caption" Color="Color.Tertiary">
                                #@FinalizedBlockNumber.ToString("N0")
                            </MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.caption" Color="Color.Warning">
                                @(FinalizedBalanceError ?? Localizer.GetString(WalletOverviewLocalizer.Keys.FinalizedUnavailable))
                            </MudText>
                        }
                    </td>
                </tr>
                <!-- Optimistic Row -->
                <tr>
                    <td>
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            <MudIcon Icon="@Icons.Material.Filled.Speed" Size="Size.Small" Color="Color.Info" />
                            <MudText Typo="Typo.caption" Style="font-weight: 600;">
                                @Localizer.GetString(WalletOverviewLocalizer.Keys.OptimisticBalance)
                            </MudText>
                            <MudTooltip Text="@Localizer.GetString(WalletOverviewLocalizer.Keys.OptimisticBalanceTooltip)">
                                <MudIcon Icon="@Icons.Material.Filled.Info" Size="Size.Small" Color="Color.Default" Style="font-size: 14px;" />
                            </MudTooltip>
                        </MudStack>
                    </td>
                    <td style="text-align: right;">
                        @if (HasOptimisticBalance)
                        {
                            <MudText Typo="Typo.body2" Style="font-weight: 600;">
                                @FormattedOptimisticBalance @CurrencySymbol
                            </MudText>
                            <MudText Typo="Typo.caption" Color="Color.Tertiary">
                                #@OptimisticBlockNumber.ToString("N0")
                            </MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.caption" Color="Color.Warning">
                                @(OptimisticBalanceError ?? Localizer.GetString(WalletOverviewLocalizer.Keys.OptimisticUnavailable))
                            </MudText>
                        }
                    </td>
                </tr>
            </tbody>
        </MudSimpleTable>
    }
</MudStack>

@code {
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public bool HasBalance { get; set; }
    [Parameter] public bool HasError { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public string FormattedBalance { get; set; } = "0";
    [Parameter] public string CurrencySymbol { get; set; } = "ETH";
    [Parameter] public ulong BlockNumber { get; set; }
    [Parameter] public bool BalancesMatch { get; set; } = true;
    [Parameter] public bool IsOptimisticMode { get; set; }
    [Parameter] public bool IsRpcLimitation { get; set; }

    [Parameter] public bool HasFinalizedBalance { get; set; }
    [Parameter] public string FormattedFinalizedBalance { get; set; } = "0";
    [Parameter] public ulong FinalizedBlockNumber { get; set; }
    [Parameter] public string? FinalizedBalanceError { get; set; }
    [Parameter] public bool FinalizedBalanceMatches { get; set; } = true;

    [Parameter] public bool HasOptimisticBalance { get; set; }
    [Parameter] public string FormattedOptimisticBalance { get; set; } = "0";
    [Parameter] public ulong OptimisticBlockNumber { get; set; }
    [Parameter] public string? OptimisticBalanceError { get; set; }
    [Parameter] public bool OptimisticBalanceMatches { get; set; } = true;
}
